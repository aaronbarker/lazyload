/*!
 * lazyLoad
 * @description	loads images onto the page as you scroll down to them
 * @version		1.4.1 - 2014/04/24
 * @author		Aaron Barker
 * @requires	ui.core.js (1.8+)
 * @copyright	Copyright 2013 by Intellectual Reserve, Inc.
 */
(function(a){"use strict";a.widget("lds.lazyLoad",{options:{lazyClass:"lazy",doneClass:"lazyLoadDone",placeholder:"data:image/gif;base64,R0lGODlhAQABAPAAAAAAAAAAACH/C1hNUCBEYXRhWE1QRT94cGFja2V0IDE2MDZCIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkZERDQ1MzVGMkZGMTExRTFBQTE4OTE5ODk4MQAh+QQFAAAAACwAAAAAAQABAEACAkQBADs=",updateOnResize:true,attList:["src","width","height","alt","class"],threshold:300,resizeDelay:100,fadeSpeed:500,loadHidden:false,mustForce:false,srcs:["2x","desktop","mobile"],srcFallback:"desktop",tests:{"2x":function(){return window.devicePixelRatio>1},mobile:function(){return a(window).width()<600},desktop:function(){return a(window).width()>600}}},_create:function(){var b=this.options,c=this,d=c.element,e=c.widgetName,f=b.doneClass,g="img."+b.lazyClass,h,i;c.imageSelector=g;if(!b.loadHidden){c.imageSelector=g+":visible"}h=c.imageSelector;a(d).delegate(g,"update."+e,function(b,d){if(a(this).hasClass(f)){i=c.getSrc(a(this));c.setSrc(a(this),i,d)}else{c.checkLocation(this,d)}}).delegate(g,"loadNow."+e,function(){c.loadNow(this)});a(window).add(b.secondaryScroll).bind("scroll."+e+" resize."+e+" orientationchange."+e,function(){clearTimeout(c.scrollTimer);c.scrollTimer=setTimeout(function(){var d=a(h);if(!b.updateOnResize){d=d.not("."+f)}c.viewportHeight=a(window).height();c.viewportTopY=a(window).scrollTop();c.viewportWidth=a(window).width();c.viewportLeftX=a(window).scrollLeft();d.trigger("update."+e,false)},c.initialized?b.resizeDelay:0)});c.initialized=true},_init:function(){var b=this,c=b.element,d=b.options,e=b.widgetName,f="noscript."+d.lazyClass;a(f,c).each(function(){var b=a(this),c=a("<img>");a.each(d.attList,function(a,d){if(b.data(d)){c.attr(d,b.data(d)||"")}});a.each(b.data(),function(a,b){c.data(a,b)});c.addClass(d.lazyClass).attr("src",d.placeholder);if(!c.attr("height")&&d.minHeight){c.attr("height",d.minHeight)}a(this).before(c);c.css("opacity","0.01");b.remove()});a(b.imageSelector,c).not("."+b.options.doneClass).each(function(){var c=b.getSrc(a(this));if(sessionStorage.getItem(c)){a(this).trigger("update."+e,true)}else{a(this).trigger("update."+e,false)}});a(window).trigger("resize."+e)},checkLocation:function(b,c){var d=this.options,e=this,f,g=/iphone|ipod/i.test(navigator.userAgent.toLowerCase())?60:0,h=a(b);if((!h.hasClass(d.doneClass)||d.updateOnResize)&&(d.loadHidden||!d.loadHidden&&h.is(":visible"))&&h.offset().top<e.viewportTopY+e.viewportHeight+d.threshold+g&&h.offset().left<e.viewportLeftX+e.viewportWidth+d.threshold+g&&!d.mustForce&&!h.data("mustforce")||c){f=e.getSrc(h);e.setSrc(h,f,c);if(d.minHeight&&!h.data("height")){h.attr("height","")}h.addClass(d.doneClass)}},getSrc:function(b){var c=this.options,d,e;a.each(c.srcs,function(a,f){e=typeof c.tests[f]==="function"?c.tests[f].call():c.tests[f];if(b.data(f)&&c.tests[f].call()){d=b.data(f);return false}});if(!d){d=b.data(c.srcFallback)}return d},setSrc:function(a,b,c){var d=this.options,e=this;if(b&&b!==a.attr("src")){a.attr("src",b).fadeTo(c?0:d.fadeSpeed,1);if(!a.data("width")){a.removeAttr("width")}if(!a.data("height")){a.removeAttr("height")}sessionStorage.setItem(b,"loaded");a.off("load.lazyLoad").on("load.lazyLoad",function(){e._trigger("onload",false,a)})}},loadNow:function(a){this.checkLocation(a,true)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);a(this.element).add(window).unbind("."+this.widgetName)}});a.extend(a.lds.lazyLoad,{version:"1.4.1"})})(jQuery);